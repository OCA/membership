<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <!-- the idea here is to have one form with all the fields an odoo
             installation thinks are necessary for successfully creating a
             partner. Then all similar forms can simply inherit this form,
             don't need to care about specific fields, and get data for a
             partner. This should become its own module if it proves helpful.
        /-->
        <template id="partner_signup_form">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure"/>
                    <div class="container">
                        <h1>Sign up for <t t-esc="request.website.company_id.name" /></h1>
                        <div class="row">
                            <div class="col-md-8">
                                <form class="form-horizontal mt32" method="post" enctype="multipart/form-data">
                                    <!-- here we try to adapt the form to modules
                                         installed because we want to avoid needing
                                         a combinatoric explosion of glue modules
                                    /-->
                                    <div t-if="'firstname' not in request.env['res.partner']" t-attf-class="form-group #{errors and 'name' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="name">Name</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="name" name="name" required="True" t-att-value="data and data.get('name', '')"/>
                                        </div>
                                    </div>
                                    <div t-if="'firstname' in request.env['res.partner']" t-attf-class="form-group #{errors and 'firstname' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="firstname">First name</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="firstname" name="firstname" required="True" t-att-value="data and data.get('firstname', '')"/>
                                        </div>
                                    </div>
                                    <div t-if="'infix' in request.env['res.partner']" t-attf-class="form-group #{errors and 'infix' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="infix">Infix</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="infix" name="infix" t-att-value="data and data.get('infix', '')"/>
                                        </div>
                                    </div>
                                    <div t-if="'lastname' in request.env['res.partner']" t-attf-class="form-group #{errors and 'lastname' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="lastname">Last name</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="lastname" name="lastname" required="True" t-att-value="data and data.get('lastname', '')"/>
                                        </div>
                                    </div>
                                    <div t-if="'street_name' not in request.env['res.partner']" t-attf-class="form-group #{errors and 'street' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="street">Street</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="street" name="street" required="True" t-att-value="data and data.get('street', '')"/>
                                        </div>
                                    </div>
                                    <div t-if="'street_name' in request.env['res.partner']" t-attf-class="form-group #{errors and 'street_name' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="street_name">Street</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="street_name" name="street_name" required="True" t-att-value="data and data.get('street_name', '')"/>
                                        </div>
                                    </div>
                                    <div t-if="'street_number' in request.env['res.partner']" t-attf-class="form-group #{errors and 'street_number' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="street_number">Street number</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="street_number" name="street_number" required="True" t-att-value="data and data.get('street_number', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{error and 'phone' in error and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="phone">Phone</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="tel" class="form-control" id="phone" name="phone" t-att-value="data and data.get('phone', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{error and 'mobile' in error and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="mobile">Mobile</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="tel" class="form-control" id="mobile" name="mobile" t-att-value="data and data.get('mobile', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{errors and 'email' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="email">Email</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="email" class="form-control" id="email" name="email" required="True" t-att-value="data and data.get('email', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{errors and 'zip' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="zip">Zip</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="zip" name="zip" required="True" t-att-value="data and data.get('zip', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{errors and 'city' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="city">City</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="city" name="city" required="True" t-att-value="data and data.get('city', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{errors and 'country_id' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="country_id">Country</label>
                                        <div class="col-md-7 col-sm-8">
                                            <select id="country_id" name="country_id" required="True" class="form-control">
                                                <option value="">Select country...</option>
                                                <t t-foreach="request.env['res.country'].sudo().search([])" t-as="country">
                                                    <option t-att-selected="(data and str(country.id) == data.get('country_id') or not data and country.id == request.env['res.partner']._website_partner_signup_get_default_value('country_id')) and 'selected' or None" t-att-value="country.id">
                                                        <t t-esc="country.name" />
                                                    </option>
                                                </t>
                                            </select>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{errors and 'acc_number' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="acc_number">Account number</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="acc_number" name="acc_number" required="True" t-att-value="data and data.get('acc_number', '')"/>
                                        </div>
                                    </div>
                                    <div t-attf-class="form-group #{errors and 'bank_bic' in errors and 'has-error' or ''}">
                                        <label class="col-md-3 col-sm-4 control-label" for="bank_bic">BIC</label>
                                        <div class="col-md-7 col-sm-8">
                                            <input type="text" class="form-control" id="bank_bic" name="bank_bic" required="True" t-att-value="data and data.get('bank_bic', '')"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-3 col-sm-offset-4 col-sm-8 col-md-7">
                                            <button type="submit" class="btn btn-primary btn-lg">Sign up</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        <template id="signup_intro">
            <section contenteditable="True">
                <div>Sign up as a member of <t t-esc="request.website.company_id.name" /></div>
            </section>
        </template>
        <template id="thankyou" name="Thank you!">
            <t t-call="website.layout">
                <div id="wrap">
                    <div class="oe_structure"/>
                    <div class="container">
                        <section contenteditable="True">
                            <h1>Sign up for <t t-esc="request.website.company_id.name" /></h1>
                            <div class="oe_structure">
                                <p>Thank you <t t-esc="partner.name" /> for signing up for <t t-esc="partner.member_lines[:1].membership_id.name" /></p>
                            </div>
                        </section>
                    </div>
                </div>
            </t>
        </template>
        <template id="signup" name="Sign up" primary="True" inherit_id="partner_signup_form">
            <xpath expr="//h1" position="after">
                <t t-call="website_membership_signup.signup_intro" />
            </xpath>
            <xpath expr="//input[@name='name']/ancestor::div[2]" position="before">
                <div t-attf-class="form-group #{errors and 'product_id' in errors and 'has-error' or ''}">
                    <label class="col-md-3 col-sm-4 control-label" for="product_id">Membership</label>
                    <div class="col-md-7 col-sm-8">
                        <select id="product_id" name="product_id" required="True" class="form-control">
                            <option value="">Select membership...</option>
                            <t t-foreach="request.env['product.product']._website_membership_signup_get_products()" t-as="membership_product">
                                <option t-att-selected="data and str(membership_product.id) == data.get('product_id') and 'selected' or None" t-att-value="membership_product.id">
                                    <t t-esc="membership_product.name" />
                                </option>
                            </t>
                        </select>
                    </div>
                </div>
            </xpath>
            <form position="attributes">
                <attribute name="action">/membership/sign_up</attribute>
            </form>
        </template>
    </data>
</openerp>
